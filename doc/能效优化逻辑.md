### 优化按钮需要的参数

点击页面上的“优化”后，出现开关机、DVFS和power capping三个选项，根据选择，调用相应的接口进行能效优化。

### 指标定义

### 能效优化机制的逻辑

1. 调度和迁移，调用对方接口，只需传递pod和目的节点信息。

2. 对方提供开关机接口。

#### 开关机

##### 调度

1. 把k8s的调度策略修改为MostAllocated；

2. 把没有pod的节点关闭；

3. 如果可用节点资源不够，再打开关闭的节点，首先打开功率低的。

##### 迁移

所有机器运行在performance模式（最大功率）。

1. 遍历系统中的pod，找到运行Pod最少的三个节点（**可作为参数？**）。

2. 把这些节点上的pod迁移到其它节点上。选择目的节点时，在资源满足要求的前提下，优先选择实时功率最低的节点。

3. 调用迁移接口，完成迁移。

4. 当某个节点没有pod时，调用关机接口，关闭该节点。

#### DVFS

基于CPUFreq实现：[https://www.jianshu.com/p/679f1561f7c6。](https://www.jianshu.com/p/679f1561f7c6%E3%80%82)

##### 调度

1. 实时监控CPU利用率，当某个机器的利用率低于某个数值时，通过dvfs把该机的cpu频率降到最低。当CPU利用率上升时，再通过dvfs恢复cpu频率。

2. k8s在筛选节点时，只在没有其它可用节点的情况下，才考虑以最低频率运行的机器（系统记录下来哪些机器运行在最低频率），如果选中了某台机器，先把它的频率恢复正常。

##### 迁移

1. 选择几个节点，让这些节点保持空闲，并把这些节点的dvfs设置为power saving模式

2. 实时监控CPU利用率，当某个机器的利用率高于某个数值时，把该节点上的pod迁移到利用率最低的节点上。循环执行迁移，直到该节点的cpu利用率低于某个数值

3. 调用dvfs，把该节点的频率降低（设置为可选频率中偏低的值）。

#### Power Capping

##### 调度

1.实时监控服务器功率，当某个机器的功率高于最大功率的一个百分比时，通过power capping限制该机的功率。

2.k8s在筛选节点时，只在没有其它可用节点的情况下，才考虑这些机器（系统记录下来哪些机器限制了功率），如果选中了某台机器，首先要解除限制。

##### 迁移 （按照论文上的算法？）

1. 实时监控服务器功率，当某个机器的功率高于最大功率的一个百分比时，首先选择一个pod，执行迁移；

2. 如果迁移之后服务器的功率仍然大于阈值，则调用rapl，限制该服务器的功率。
